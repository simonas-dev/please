#!/usr/bin/env ruby

require_relative '../lib/ollama_wrapper'
require_relative '../lib/version'

def show_usage
  puts <<~USAGE
    Please v#{PleaseConsts::VERSION} - Ollama prompt runner with built-in prompts
    
    Usage:
      please <alias_name> [additional_args...]     - Run a prompt alias
      pls list                                     - List all available aliases
      pls help                                     - Show this help
    
    Options:
      -v                                           - Verbose mode (show input prompt)
    
    Examples:
      pls lastCommitScope                          - Run the scope of impact analysis
      pls -v lastCommitScope                       - Run with verbose output
      pls list                                     - Show all available prompt aliases
  USAGE
end

if ARGV.empty? || ARGV[0] == 'help' || ARGV[0] == '--help' || ARGV[0] == '-h'
  show_usage
  exit 0
end

wrapper = OllamaWrapper.new

# Parse flags
verbose = false
args_start = 0

ARGV.each_with_index do |arg, index|
  if arg == '-v'
    verbose = true
    args_start = index + 1
    break
  elsif !arg.start_with?('-')
    args_start = index
    break
  end
end

remaining_args = ARGV[args_start..-1] || []

case remaining_args[0]
when 'list'
  wrapper.list_aliases
else
  # Run the specified alias with any additional arguments
  alias_name = remaining_args[0]
  additional_args = remaining_args[1..-1] || []
  
  unless wrapper.run(alias_name, verbose, *additional_args)
    exit 1
  end
end